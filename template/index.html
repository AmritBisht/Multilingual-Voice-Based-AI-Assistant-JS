<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Multilingual Voice Chatbot</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f6f8fa;
      margin: 0;
      padding: 0;
    }

    header {
      background: #4a90e2;
      color: white;
      padding: 20px;
      text-align: center;
    }

    #chat {
      max-width: 600px;
      margin: 20px auto;
      padding: 10px;
    }

    .msg {
      padding: 10px 15px;
      border-radius: 10px;
      margin-bottom: 10px;
      max-width: 80%;
      clear: both;
    }

    .user {
      background-color: #d1f0ff;
      float: right;
      text-align: right;
    }

    .ai {
      background-color: #e7d8ff;
      float: left;
      text-align: left;
    }

    #controls {
      text-align: center;
      margin: 30px auto;
    }

    #recordBtn {
      background: #ff4b5c;
      color: white;
      border: none;
      border-radius: 10px;
      padding: 12px 24px;
      font-size: 16px;
      cursor: pointer;
    }

    #langSelect {
      padding: 8px;
      font-size: 14px;
      margin-bottom: 10px;
      border-radius: 8px;
    }
  </style>
</head>
<body>

<header>
  <h2>🌍 Multilingual Voice Chatbot</h2>
  <p>Speak your language, hear AI respond in it!</p>
</header>

<div id="chat"></div>

<div id="controls">
  <select id="langSelect">
    <option value="en-US">English 🇺🇸</option>
    <option value="hi-IN">Hindi 🇮🇳</option>
    <option value="fr-FR">French 🇫🇷</option>
    <option value="es-ES">Spanish 🇪🇸</option>
  </select>
  <br>
  <button id="recordBtn" onclick="startRecording()">🎤 Talk</button>
</div>

<script>
let mediaRecorder;
let audioChunks = [];

async function startRecording() {
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  mediaRecorder = new MediaRecorder(stream);
  audioChunks = [];

  mediaRecorder.ondataavailable = e => audioChunks.push(e.data);

  mediaRecorder.onstop = async () => {
    const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
    const formData = new FormData();
    const lang = document.getElementById("langSelect").value;
    formData.append("file", audioBlob, "recording.webm");
    formData.append("language", lang);

    const response = await fetch("https://multilingual-voice-based-ai-assistant-js.onrender.com/process_audio/", {
      method: "POST",
      body: formData
    });

    const data = await response.json();

    if (data.transcription) {
      addMessage(data.transcription, "user");
    }

    if (data.response) {
      addMessage(data.response, "ai");
      speakText(data.response, lang);
    }
  };

  mediaRecorder.start();
  setTimeout(() => mediaRecorder.stop(), 5000); // Record 5 seconds
}

function addMessage(text, sender) {
  const msg = document.createElement("div");
  msg.className = `msg ${sender}`;
  msg.innerText = text;
  document.getElementById("chat").appendChild(msg);
  window.scrollTo(0, document.body.scrollHeight);
}

function speakText(text, lang) {
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = lang;
  speechSynthesis.speak(utterance);
}
</script>

</body>
</html>
